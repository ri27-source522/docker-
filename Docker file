FROM python:3.6-slim

# Avoid interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive
ENV TERM=linux

# Set up locale environment variables
ENV LANGUAGE=en_US.UTF-8
ENV LANG=en_US.UTF-8
ENV LC_ALL=en_US.UTF-8
ENV LC_CTYPE=en_US.UTF-8
ENV LC_MESSAGES=en_US.UTF-8

RUN set -ex \
    && apt-get update -yqq \
    && apt-get install -yq --no-install-recommends apt-utils locales \
    && sed -i '/^# *\(en_US.UTF-8 UTF-8\)/s/^# *//' /etc/locale.gen \
    && locale-gen en_US.UTF-8 \
    && update-locale LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8 \
    && apt-get install -yq --no-install-recommends \
        build-essential \
        default-libmysqlclient-dev \
        git \
        curl \
        rsync \
        netcat \
        locales \
        libpq5 \
        libpq-dev \
        freetds-bin \
        freetds-dev \
        libkrb5-dev \
        libssl-dev \
        libffi-dev \
        procps \
        jq \
    || apt-get install -yqq --fix-missing \
    && pip install mlflow==1.11.0 mysql-connector-python boto3 \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/man /usr/share/doc /usr/share/doc-base

COPY entrypoint.sh /entrypoint.sh
EXPOSE 5000
ENTRYPOINT ["/entrypoint.sh"]